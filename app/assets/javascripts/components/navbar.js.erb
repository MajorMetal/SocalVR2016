var navbarController = (function () {
  var links = document.querySelectorAll('.navbar-menu > ul > li > a'),
      banner = document.querySelector('.banner'),
      mouseClicked;


// =========================
//   Active Page Selector
// =========================
  function activePageSelector (path) {
    var buttons = {
      '/': links[0],
      '/expo': links[1]
    };

    buttons[path].className = 'active';
  }


// =========================
//     Banner Recoloring
// =========================
  function bannerRecolor () {
    if (banner) {
      var main = document.querySelector('main'),
          navbar = document.querySelector('.navbar'),
          img = navbar.querySelector('.navbar-logo > img');

      main.style.paddingTop = '0';
      navbar.className = 'navbar navbar-banner';
      img.src = "<%= asset_path('logo-white.png') %>";
    }
  }


// =========================
//     Element Creators
// =========================
  function createRippleContainer () {
    var element = document.createElement('div');

    element.className = 'ripple-container';

    return element;
  }

  function createFocusRipple (height, width) {
    var element = document.createElement('span'),
        rippleWidth = width * 0.9;

    element.className = 'ripple focus';
    element.style.top = ((height - rippleWidth) / 2) + 'px';
    element.style.left = '5%';
    element.style.height = rippleWidth + 'px';
    element.style.width = rippleWidth + 'px';
    element.style.backgroundColor = '#EEEEEE';

    return element;
  }

  function createClickRipple (yPos, xPos, width) {
    var element = document.createElement('span');

    element.className = 'ripple click';
    element.style.top = (yPos - (width / 2)) + 'px';
    element.style.left = (xPos - (width / 2)) + 'px';
    element.style.height = width + 'px';
    element.style.width = width + 'px';
    element.style.backgroundColor = '#BDBDBD';

    return element;
  }


// =========================
//      Event Handlers
// =========================
  function onFocusHandler () {
    if (!mouseClicked) {
      var container = createRippleContainer(),
          ripple = createFocusRipple(this.clientHeight, this.clientWidth);

      container.appendChild(ripple);
      this.appendChild(container);
    }
  }

  function onBlurHandler () {
    var ripple = this.querySelector('.ripple-container');

    if (ripple) {
      this.removeChild(ripple);
    }
  }

  function onMouseDownHandler (event) {
    if (!mouseClicked) {
      var self = this,
          ripple = createClickRipple(event.offsetY, event.offsetX, (this.clientHeight + this.clientWidth));

      mouseClicked = true;
      self.appendChild(ripple);

      setTimeout(function () {
        self.removeChild(ripple);
        mouseClicked = false;
      }, 700);
    }
  }


// =========================
//      Event Listeners
// =========================
  for (var i = 0; i < links.length; i++) {
    links[i].addEventListener('focus', onFocusHandler);
    links[i].addEventListener('blur', onBlurHandler);
    links[i].addEventListener('mousedown', onMouseDownHandler);
  }

  activePageSelector(location.pathname);
  bannerRecolor();
});
